// CLEAR FIELDS POSTFUNCTIONS
apply plugin: 'org.gint.atlassian'

def info =	 gint.getJiraHelper().getServerInfoWithVerify() // Verify access to Jira instance otherwise end test if server not available
def project =	 gint.getJiraHelper().getProjectKey()	//get project key using jira helper functions
def workflow =	 project	//Name of the workflow will be same as project name
def workflowScheme =	 project	//Name of the workflow scheme will be same as project name
def screen =	"Default Screen"	//Add screen to each transition to transition issue with required criteria
def startStep =	info ?.isCloud ? '1' : '11' // depends on workflow. '11' (To Do) works for custom jira workflow
def functionKey =	info ?.isCloud ? 'com.atlassian.plugins.atlassian-connect-plugin:com.innovalog.mwec__ClearFieldsFunction' : 'com.innovalog.jmwe.jira-misc-workflow-extensions:ClearFieldValue-function'	//function key for current status condition
def type =	'postfunction'

def transition = 'clearFields'

(1..34).each { number ->
    gint.taskHelper.addSetUp(
        action: 'addTransition', ext: number,
        end: true,
        parameters: [
            workflow: workflow,
            name: transition + number,
            description: 'Transition for clearFieldsPF ' + number,
            step: startStep,
            screen: screen,
        ],
        data: [
            "Transition '${transition + number}' added to workflow '${workflow}' with id ",
        ],
    )
}
(1..34).each { number ->
  def clearFieldsData
    if (number == 1)
    	clearFieldsData = "{\"fields\":\"versions\",\"useGroovyCondition\":\"no\",\"throwExceptions\":\"false\",\"correlationId\":\"\"}"
     else if (number == 2)
        clearFieldsData = "{\"fields\":\"comment\",\"useGroovyCondition\":\"no\",\"throwExceptions\":\"false\",\"correlationId\":\"\"}"
     else if (number == 3)
        clearFieldsData = "{\"fields\":\"environment\",\"useGroovyCondition\":\"no\",\"throwExceptions\":\"false\",\"correlationId\":\"\"}"
     else if (number == 4)
        clearFieldsData = "{\"fields\":\"issuetype\",\"useGroovyCondition\":\"no\",\"throwExceptions\":\"false\",\"correlationId\":\"\"}"
     else if (number == 5)
        clearFieldsData = "{\"fields\":\"timeoriginalestimate\",\"useGroovyCondition\":\"no\",\"throwExceptions\":\"false\",\"correlationId\":\"\"}"
     else if (number == 6)
        clearFieldsData = "{\"fields\":\"priority\",\"useGroovyCondition\":\"no\",\"throwExceptions\":\"false\",\"correlationId\":\"\"}"
     else if (number == 7)
       clearFieldsData = "{\"fields\":\"timeestimate\",\"useGroovyCondition\":\"no\",\"throwExceptions\":\"false\",\"correlationId\":\"\"}"
     else if (number == 8)
        clearFieldsData = "{\"fields\":\"timespent\",\"useGroovyCondition\":\"no\",\"throwExceptions\":\"false\",\"correlationId\":\"\"}"
     else if (number == 9)
        clearFieldsData = "{\"fields\":\"resolution\",\"useGroovyCondition\":\"no\",\"throwExceptions\":\"false\",\"correlationId\":\"\"}"
     else if (number == 10)
        clearFieldsData = "{\"fields\":\"resolutiondate\",\"useGroovyCondition\":\"no\",\"throwExceptions\":\"false\",\"correlationId\":\"\"}"
     else if (number == 11)
        clearFieldsData = "{\"fields\":\"status\",\"useGroovyCondition\":\"no\",\"throwExceptions\":\"false\",\"correlationId\":\"\"}"
     else if (number == 12)
        clearFieldsData = "{\"fields\":\"fixVersions\",\"useGroovyCondition\":\"no\",\"throwExceptions\":\"false\",\"correlationId\":\"\"}"
     else if (number == 13)
        clearFieldsData = "{\"fields\":\"assignee\",\"useGroovyCondition\":\"no\",\"throwExceptions\":\"false\",\"correlationId\":\"\"}"
     else if (number == 14)
        clearFieldsData = "{\"fields\":\"attachment\",\"useGroovyCondition\":\"no\",\"throwExceptions\":\"false\",\"correlationId\":\"\"}"
     else if (number == 15)
        clearFieldsData = "{\"fields\":\"description\",\"useGroovyCondition\":\"no\",\"throwExceptions\":\"false\",\"correlationId\":\"\"}"
     else if (number == 16)
        clearFieldsData = "{\"fields\":\"labels\",\"useGroovyCondition\":\"no\",\"throwExceptions\":\"false\",\"correlationId\":\"\"}"
     else if (number == 17)
        clearFieldsData = "{\"fields\":\"issuelinks\",\"useGroovyCondition\":\"no\",\"throwExceptions\":\"false\",\"correlationId\":\"\"}"
     else if (number == 18)
        clearFieldsData = "{\"fields\":\"security\",\"useGroovyCondition\":\"no\",\"throwExceptions\":\"false\",\"correlationId\":\"\"}"
     else if (number == 19)
        clearFieldsData = "{\"fields\":\"votes\",\"useGroovyCondition\":\"no\",\"throwExceptions\":\"false\",\"correlationId\":\"\"}"
     else if (number == 20)
        clearFieldsData = "{\"fields\":\"watches\",\"useGroovyCondition\":\"no\",\"throwExceptions\":\"false\",\"correlationId\":\"\"}"
     else if (number == 21)
        clearFieldsData = "{\"fields\":\"reporter\",\"useGroovyCondition\":\"no\",\"throwExceptions\":\"false\",\"correlationId\":\"\"}"
     else if (number == 22)
        clearFieldsData = "{\"fields\":\"customfield_10106\",\"useGroovyCondition\":\"no\",\"throwExceptions\":\"false\",\"correlationId\":\"\"}"   //story points
     else if (number == 23)
        clearFieldsData = "{\"fields\":\"customfield_10109\",\"useGroovyCondition\":\"no\",\"throwExceptions\":\"false\",\"correlationId\":\"\"}"   //Target end
     else if (number == 24)
        clearFieldsData = "{\"fields\":\"customfield_10108\",\"useGroovyCondition\":\"no\",\"throwExceptions\":\"false\",\"correlationId\":\"\"}"   //Target start
     else if (number == 25)
        clearFieldsData = "{\"fields\":\"customfield_10111\",\"useGroovyCondition\":\"no\",\"throwExceptions\":\"false\",\"correlationId\":\"\"}"   //team
     else if (number == 26)
        clearFieldsData = "{\"fields\":\"archiveddate\",\"useGroovyCondition\":\"no\",\"throwExceptions\":\"false\",\"correlationId\":\"\"}"   //archiveddate
     else if (number == 27)
        clearFieldsData = "{\"fields\":\"archivedby\",\"useGroovyCondition\":\"no\",\"throwExceptions\":\"false\",\"correlationId\":\"\"}"   //archivedby
     else if (number == 28)
        clearFieldsData = "{\"fields\":\"customfield_10104\",\"useGroovyCondition\":\"no\",\"throwExceptions\":\"false\",\"correlationId\":\"\"}" //Epic color
     else if (number == 29)
        clearFieldsData = "{\"fields\":\"customfield_10101\",\"useGroovyCondition\":\"no\",\"throwExceptions\":\"false\",\"correlationId\":\"\"}"   //Epic link
     else if (number == 30)
        clearFieldsData = "{\"fields\":\"customfield_10103\",\"useGroovyCondition\":\"no\",\"throwExceptions\":\"false\",\"correlationId\":\"\"}" //Epic name
     else if (number == 31)
        clearFieldsData = "{\"fields\":\"customfield_10102\",\"useGroovyCondition\":\"no\",\"throwExceptions\":\"false\",\"correlationId\":\"\"}"   //Epic status
     else if (number == 32)
        clearFieldsData = "{\"fields\":\"customfield_10110\",\"useGroovyCondition\":\"no\",\"throwExceptions\":\"false\",\"correlationId\":\"\"}"   //original story points
     else if (number == 33)
        clearFieldsData = "{\"fields\":\"customfield_10107\",\"useGroovyCondition\":\"no\",\"throwExceptions\":\"false\",\"correlationId\":\"\"}"   //parent link
     else if (number == 34)
        clearFieldsData = "{\"fields\":\"customfield_10105\",\"useGroovyCondition\":\"no\",\"throwExceptions\":\"false\",\"correlationId\":\"\"}"   //sprint

gint.taskHelper.addSetUp(
	action: 'addTransitionFunction', ext: number,
        dependsOn: true,
        end: true, // one at a time
        parameters: [
            workflow: workflow,
            transition: transition + number,
            functionKey: functionKey,
            type: type,
            step: startStep,
            data: clearFieldsData,
        ],
        data: [
            "Transition function of type ${type} added to workflow '${workflow}'.",
        ],
    )
}
